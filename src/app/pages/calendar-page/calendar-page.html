<div class="bg-background-dark min-h-screen p-6">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div class="flex items-center gap-3">
      <h1 class="text-2xl font-bold text-text-dark-secondary">Calendar</h1>
      <button
        (click)="goToToday()"
        class="text-sm px-3 py-1 rounded-lg bg-primary/20 text-primary hover:bg-primary/30 transition-colors"
      >
        Today
      </button>
    </div>

    <!-- Month Navigation -->
    <div class="flex items-center gap-4">
      <button
        (click)="previousMonth()"
        class="p-2 rounded-lg hover:bg-card-dark transition-colors"
        aria-label="Previous month"
      >
        <span class="material-symbols-outlined text-text-dark-primary">chevron_left</span>
      </button>
      <span class="text-lg font-semibold text-text-dark-primary min-w-40 text-center">
        {{ monthYearDisplay() }}
      </span>
      <button
        (click)="nextMonth()"
        class="p-2 rounded-lg hover:bg-card-dark transition-colors"
        aria-label="Next month"
      >
        <span class="material-symbols-outlined text-text-dark-primary">chevron_right</span>
      </button>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Calendar Grid -->
    <div class="lg:col-span-2 bg-card-dark rounded-xl p-6">
      <!-- Week day headers -->
      <div class="grid grid-cols-7 gap-1 mb-2">
        @for (day of weekDayLabels; track day) {
          <div class="text-center text-sm font-medium text-text-dark-secondary py-2">{{ day }}</div>
        }
      </div>

      <!-- Loading state -->
      @if (isLoading()) {
        <div class="flex items-center justify-center py-20">
          <span class="material-symbols-outlined animate-spin text-4xl text-primary">progress_activity</span>
        </div>
      } @else {
        <!-- Calendar days -->
        <div class="grid grid-cols-7 gap-1">
          @for (day of calendarDays(); track day.dateStr) {
            <button
              (click)="selectDate(day)"
              class="relative flex flex-col items-center justify-start p-2 min-h-[72px] rounded-xl transition-all duration-200 cursor-pointer hover:bg-background-dark"
              [class.opacity-40]="!day.isCurrentMonth"
              [class.ring-2]="day.isSelected"
              [class.ring-primary]="day.isSelected"
              [class.bg-primary/20]="day.isSelected"
            >
              <span class="text-sm font-medium mb-1"
                [class.text-text-dark-primary]="day.isCurrentMonth"
                [class.text-text-dark-muted]="!day.isCurrentMonth"
              >{{ day.dayOfMonth }}</span>

              @if (day.totalCount > 0) {
                <div class="flex items-center justify-center w-6 h-6 rounded-full text-xs"
                  [class.text-green-400]="getDayStatus(day) === 'complete'"
                  [class.text-yellow-400]="getDayStatus(day) === 'partial'"
                  [class.text-text-dark-muted]="getDayStatus(day) === 'incomplete'"
                >
                  @if (getDayStatus(day) === 'complete') {
                    <span class="material-symbols-outlined text-xs">check_circle</span>
                  } @else if (getDayStatus(day) === 'partial') {
                    <span class="text-xs font-medium">{{ day.completedCount }}/{{ day.totalCount }}</span>
                  } @else {
                    <span class="material-symbols-outlined text-xs">circle</span>
                  }
                </div>
              }
            </button>
          }
        </div>
      }

      <!-- Legend -->
      <div class="flex items-center justify-center gap-6 mt-6 pt-4 border-t border-border-dark">
        <div class="flex items-center gap-2 text-sm text-text-dark-secondary">
          <span class="w-3 h-3 rounded-full bg-green-400"></span>
          <span>All complete</span>
        </div>
        <div class="flex items-center gap-2 text-sm text-text-dark-secondary">
          <span class="w-3 h-3 rounded-full bg-yellow-400"></span>
          <span>Partial</span>
        </div>
        <div class="flex items-center gap-2 text-sm text-text-dark-secondary">
          <span class="w-3 h-3 rounded-full bg-text-dark-muted"></span>
          <span>Incomplete</span>
        </div>
      </div>
    </div>

    <!-- Selected Day Detail Panel -->
    <div class="bg-card-dark rounded-xl p-6">
      <h2 class="text-lg font-semibold text-text-dark-primary mb-4 pb-4 border-b border-border-dark">
        {{ formatSelectedDate() }}
      </h2>

      @if (habitsForSelectedDate().length === 0) {
        <div class="flex flex-col items-center justify-center py-12 text-center">
          <span class="material-symbols-outlined text-4xl text-text-dark-muted mb-2">event_available</span>
          <p class="text-text-dark-secondary">No habits scheduled for this day</p>
        </div>
      } @else {
        <div class="space-y-3">
          @for (habit of habitsForSelectedDate(); track habit.id) {
            <div
              class="flex items-center gap-3 p-3 rounded-xl bg-background-dark transition-all duration-200 hover:bg-background-dark/80"
              [class.opacity-70]="habit.completedToday"
            >
              <button
                (click)="toggleHabit(habit.id)"
                class="flex items-center justify-center w-6 h-6 rounded-full border-2 transition-all duration-200"
                [class.border-text-dark-muted]="!habit.completedToday"
                [class.hover:border-primary]="!habit.completedToday"
                [class.bg-primary]="habit.completedToday"
                [class.border-primary]="habit.completedToday"
                [class.text-white]="habit.completedToday"
              >
                @if (habit.completedToday) {
                  <span class="material-symbols-outlined text-sm">check</span>
                }
              </button>

              <div class="flex-1 flex items-center gap-2 min-w-0">
                <span class="text-text-dark-primary truncate" [class.line-through]="habit.completedToday">
                  {{ habit.title }}
                </span>
                @if (habit.category) {
                  <span
                    class="text-xs px-2 py-0.5 rounded-full text-white font-medium capitalize"
                    [style.background-color]="'var(--color-category-' + habit.category + ')'"
                  >
                    {{ habit.category }}
                  </span>
                }
              </div>

              <span class="text-xs text-text-dark-secondary capitalize">
                {{ habit.frequency }}
              </span>
            </div>
          }
        </div>

        <!-- Summary -->
        <div class="flex gap-4 mt-6 pt-4 border-t border-border-dark">
          <div class="flex-1 text-center">
            <span class="text-2xl font-bold text-text-dark-primary block">{{ habitsForSelectedDate().length }}</span>
            <span class="text-sm text-text-dark-secondary">Scheduled</span>
          </div>
          <div class="flex-1 text-center">
            <span class="text-2xl font-bold text-green-400 block">
              {{ completedCountForSelectedDate() }}
            </span>
            <span class="text-sm text-text-dark-secondary">Completed</span>
          </div>
        </div>
      }
    </div>
  </div>
</div>
