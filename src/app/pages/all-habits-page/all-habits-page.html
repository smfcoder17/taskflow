<div class="bg-background-dark min-h-screen pt-4 pb-20">
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Page Header -->
    <div class="mb-10 flex flex-col md:flex-row md:items-end justify-between gap-6">
      <div>
        <h1 class="text-4xl font-black text-text-dark-primary tracking-tight">
          Your <span class="text-primary">Journey</span>
        </h1>
        <p class="text-text-dark-secondary mt-2 flex items-center gap-2">
          <span class="material-symbols-outlined text-sm">analytics</span>
          You have <span class="text-text-dark-primary font-bold">{{ totalHabits() }}</span> habits on your radar, 
          <span class="text-primary font-bold">{{ activeHabits() }}</span> are currently active.
        </p>
      </div>
      <button
        (click)="createNewHabit()"
        class="flex items-center justify-center gap-2 px-6 py-3 bg-primary hover:bg-primary/90 text-background-dark font-bold rounded-2xl transition-all hover:shadow-[0_0_20px_rgba(16,185,129,0.3)] group"
      >
        <span class="material-symbols-outlined transition-transform group-hover:rotate-90">add</span>
        Build New Habit
      </button>
    </div>

    <!-- Search Bar & View Toggle -->
    <div class="mb-8 flex flex-col sm:flex-row gap-4">
      <!-- Search -->
      <div class="relative flex-1 group">
        <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-text-dark-secondary group-focus-within:text-primary transition-colors">
          search
        </span>
        <input
          type="text"
          [value]="searchQuery()"
          (input)="onSearchChange($event)"
          placeholder="Filter your habits..."
          class="w-full bg-card-dark border border-border-dark-strong rounded-2xl pl-12 pr-12 py-4 text-text-dark-primary placeholder:text-text-dark-secondary/50 outline-none focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all shadow-sm"
        />
        @if (searchQuery()) {
        <button
          (click)="clearSearch()"
          class="absolute right-4 top-1/2 -translate-y-1/2 text-text-dark-secondary hover:text-text-dark-primary transition-colors"
        >
          <span class="material-symbols-outlined">close</span>
        </button>
        }
      </div>

      <!-- View Toggle -->
      <div class="flex items-center gap-1 bg-card-dark rounded-2xl p-1.5 border border-border-dark-strong shadow-sm shrink-0">
        <button
          (click)="toggleView('list')"
          [class.bg-background-dark]="viewMode() === 'list'"
          [class.text-primary]="viewMode() === 'list'"
          [class.shadow-md]="viewMode() === 'list'"
          [class.text-text-dark-secondary]="viewMode() !== 'list'"
          class="flex items-center gap-2 px-5 py-2.5 rounded-xl transition-all font-medium"
        >
          <span class="material-symbols-outlined text-lg">view_list</span>
          <span>List</span>
        </button>
        <button
          (click)="toggleView('grid')"
          [class.bg-background-dark]="viewMode() === 'grid'"
          [class.text-primary]="viewMode() === 'grid'"
          [class.shadow-md]="viewMode() === 'grid'"
          [class.text-text-dark-secondary]="viewMode() !== 'grid'"
          class="flex items-center gap-2 px-5 py-2.5 rounded-xl transition-all font-medium"
        >
          <span class="material-symbols-outlined text-lg">grid_view</span>
          <span>Grid</span>
        </button>
      </div>
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
    <div class="flex flex-col items-center justify-center py-24 space-y-4">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary border-t-transparent shadow-sm"></div>
      <p class="text-text-dark-secondary animate-pulse">Gathering your progress...</p>
    </div>
    }
    
    <!-- Empty State -->
    @else if (habits().length === 0) {
    <div class="bg-card-dark border border-dashed border-border-dark-strong rounded-3xl p-16 text-center shadow-xl">
      <div class="w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6">
        <span class="material-symbols-outlined text-4xl text-primary">auto_awesome</span>
      </div>
      <p class="text-2xl text-text-dark-primary font-bold mb-3">Clean slate. Big dreams.</p>
      <p class="text-text-dark-secondary max-w-sm mx-auto mb-8">You haven't tracked any habits yet. Today is a great day to start something new.</p>
      <button
        (click)="createNewHabit()"
        class="inline-flex items-center gap-2 px-8 py-4 bg-primary hover:bg-primary/90 text-background-dark font-black rounded-2xl transition-all shadow-lg hover:scale-105"
      >
        <span class="material-symbols-outlined">add</span>
        Create Your First Habit
      </button>
    </div>
    }
    
    <!-- No Search Results -->
    @else if (filteredHabits().length === 0) {
    <div class="bg-card-dark border border-border-dark-strong rounded-3xl p-16 text-center shadow-sm">
      <span class="material-symbols-outlined text-6xl text-text-dark-secondary/20 mb-4">search_off</span>
      <p class="text-xl text-text-dark-primary font-medium mb-2">No matches found</p>
      <p class="text-text-dark-secondary">We couldn't find any habits matching your search.</p>
      <button (click)="clearSearch()" class="mt-6 text-primary hover:underline font-bold">Clear filters</button>
    </div>
    }
    
    <!-- Habits Content - Grouped by Category -->
    @else {
      @for (group of groupedHabits(); track group.category; let i = $index) {
        <div class="mb-10">
          <!-- Category Header -->
          <div class="flex items-center gap-4 mb-4 px-2">
            <span class="text-2xl w-10 h-10 flex items-center justify-center bg-card-dark rounded-xl border border-border-dark-strong">
              {{ getCategoryEmoji(group.category) }}
            </span>
            <h2 class="text-xl font-bold text-text-dark-primary">{{ group.category }}</h2>
            <div class="h-px flex-1 bg-border-dark-strong/50"></div>
            <span class="text-xs font-bold text-text-dark-secondary bg-card-dark border border-border-dark-strong px-2.5 py-1 rounded-lg">
              {{ group.habits.length }}
            </span>
          </div>

          <!-- LIST VIEW -->
          @if (viewMode() === 'list') {
            <div class="space-y-3">
              @for (habit of group.habits; track habit.id) {
                <div class="group bg-card-dark hover:bg-card-dark/80 border border-border-dark-strong hover:border-primary/30 rounded-2xl p-4 sm:p-5 transition-all shadow-sm hover:shadow-lg flex items-center gap-4 sm:gap-6">
                  <!-- Icon & Title -->
                  <div class="flex items-center gap-4 flex-1 min-w-0">
                    <div class="w-12 h-12 shrink-0 bg-background-dark rounded-xl flex items-center justify-center text-2xl group-hover:scale-110 transition-transform">
                      {{ getHabitIcon(habit.category) }}
                    </div>
                    <div class="truncate">
                      <h3 class="text-base font-bold text-text-dark-primary group-hover:text-primary transition-colors truncate">
                        {{ habit.title }}
                      </h3>
                      <div class="flex items-center gap-2 mt-1">
                        <span class="text-[10px] uppercase font-bold tracking-wider px-2 py-0.5 bg-background-dark text-text-dark-secondary rounded-full border border-border-dark-strong/50">
                          {{ getFrequencyLabel(habit) }}
                        </span>
                        @if (habit.timeOfDay) {
                        <span class="text-[10px] uppercase font-bold tracking-wider text-text-dark-secondary flex items-center gap-1">
                          <span class="material-symbols-outlined text-[12px]">schedule</span>
                          {{ habit.timeOfDay }}
                        </span>
                        }
                      </div>
                    </div>
                  </div>

                  <!-- Stats -->
                  <div class="hidden sm:flex items-center gap-8 shrink-0 px-4">
                    <div class="text-center">
                      <p class="text-[10px] text-text-dark-secondary uppercase font-bold tracking-tighter mb-0.5">Streak</p>
                      <div class="flex items-center gap-1.5 justify-center">
                        <span class="text-lg">{{ getStreakIcon(habit.currentStreak || 0) }}</span>
                        <span [class]="getStreakClass(habit.currentStreak || 0)" class="text-base font-black leading-none">
                          {{ habit.currentStreak || 0 }}
                        </span>
                      </div>
                    </div>
                  </div>

                  <!-- Actions -->
                  <div class="flex items-center gap-1 shrink-0 bg-background-dark/50 p-1 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity">
                    <button
                      (click)="editHabit(habit)"
                      class="p-2 text-text-dark-secondary hover:text-primary hover:bg-primary/10 rounded-lg transition-all"
                      title="Edit Settings"
                    >
                      <span class="material-symbols-outlined text-lg">settings</span>
                    </button>
                    <button
                      (click)="openDeleteModal(habit)"
                      class="p-2 text-text-dark-secondary hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-all"
                      title="Delete Habit"
                    >
                      <span class="material-symbols-outlined text-lg">delete</span>
                    </button>
                  </div>
                </div>
              }
            </div>
          }

          <!-- GRID VIEW -->
          @else {
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
              @for (habit of group.habits; track habit.id) {
                <div class="group relative bg-card-dark hover:bg-card-dark/80 border border-border-dark-strong hover:border-primary/40 rounded-3xl p-6 transition-all shadow-sm hover:shadow-xl hover:-translate-y-1">
                  <!-- Header: Icon & Streak -->
                  <div class="flex items-start justify-between mb-6">
                    <div class="w-14 h-14 bg-background-dark rounded-2xl flex items-center justify-center text-3xl group-hover:rotate-12 transition-transform shadow-inner">
                      {{ getHabitIcon(habit.category) }}
                    </div>
                    
                    <div class="flex flex-col items-end">
                      <div class="flex items-center gap-1 bg-background-dark px-3 py-1.5 rounded-full border border-border-dark-strong shadow-sm">
                        <span class="text-lg">{{ getStreakIcon(habit.currentStreak || 0) }}</span>
                        <span [class]="getStreakClass(habit.currentStreak || 0)" class="text-base font-black">
                          {{ habit.currentStreak || 0 }}
                        </span>
                      </div>
                    </div>
                  </div>

                  <!-- Content -->
                  <div class="mb-8">
                    <h3 class="text-lg font-black text-text-dark-primary group-hover:text-primary transition-colors line-clamp-2 leading-tight mb-2">
                      {{ habit.title }}
                    </h3>
                    <div class="flex flex-wrap gap-2">
                       <span class="text-[10px] uppercase font-black tracking-widest text-text-dark-secondary">
                        {{ getFrequencyLabel(habit) }}
                      </span>
                      @if (habit.timeOfDay) {
                      <span class="text-[10px] uppercase font-black tracking-widest text-text-dark-secondary/60 flex items-center gap-1">
                         {{ habit.timeOfDay }}
                      </span>
                      }
                    </div>
                  </div>

                  <!-- Actions Overlay (or bottom row) -->
                  <div class="flex items-center justify-end gap-2 pt-4 border-t border-border-dark-strong/30">
                    <button
                      (click)="editHabit(habit)"
                      class="flex items-center gap-2 px-3 py-1.5 text-xs font-bold text-text-dark-secondary hover:text-primary hover:bg-primary/10 rounded-lg transition-all"
                    >
                      <span class="material-symbols-outlined text-sm">settings</span>
                      Configure
                    </button>
                    <button
                      (click)="openDeleteModal(habit)"
                      class="p-2 text-text-dark-secondary hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-all"
                    >
                      <span class="material-symbols-outlined text-sm">delete</span>
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      }
    }
  </main>
</div>

<!-- Delete Confirmation Modal -->
@if (showDeleteModal()) {
<app-confirmation-modal
  [isOpen]="showDeleteModal()"
  [title]="'Delete Habit'"
  [message]="'Are you sure you want to delete &quot;' + (habitToDelete()?.title || '') + '&quot;? This action cannot be undone.'"
  [confirmText]="'Delete'"
  [cancelText]="'Cancel'"
  [confirmClass]="'bg-red-500 hover:bg-red-600'"
  (confirmed)="confirmDelete()"
  (cancelled)="closeDeleteModal()"
/>
}
