<!-- Mobile Toggle Button -->
<button
  (click)="toggleSidebar()"
  class="fixed top-4 left-4 z-50 sm:hidden p-2 rounded-lg bg-card-dark border border-border-dark text-text-dark-primary hover:bg-background-dark transition-colors"
  [class.hidden]="isOpen()"
>
  <span class="material-symbols-outlined text-xl">menu</span>
</button>

<!-- Desktop Collapse Toggle -->
<button
  (click)="toggleCollapse()"
  class="hidden sm:flex fixed top-4 z-45 p-2 rounded-lg bg-card-dark border border-border-dark text-text-dark-primary hover:bg-background-dark transition-all duration-300"
  [class.left-64]="!isCollapsed()"
  [class.left-4]="isCollapsed()"
>
  <span
    class="material-symbols-outlined transition-transform duration-300"
    [class.rotate-180]="isCollapsed()"
  >
    chevron_left
  </span>
</button>

<!-- Backdrop overlay for mobile -->
@if (isOpen()) {
<div class="fixed inset-0 bg-black/50 z-30 sm:hidden" (click)="closeSidebar()"></div>
}

<!-- Sidebar -->
<aside
  class="h-screen bg-card-dark flex flex-col border-r border-border-dark overflow-y-auto transition-all duration-300 z-40"
  [ngClass]="{
    'fixed inset-y-0 left-0 w-72': true,
    'translate-x-0': isOpen(),
    '-translate-x-full': !isOpen(),
    'sm:translate-x-0': !isCollapsed(),
    'sm:-translate-x-full': isCollapsed(),
    'sm:sticky sm:top-0 sm:shrink-0': !isCollapsed()
  }"
>
  <!-- Close button for mobile -->
  <button
    (click)="closeSidebar()"
    class="absolute top-4 right-4 sm:hidden p-1 rounded-lg text-text-dark-secondary hover:text-text-dark-primary hover:bg-border-dark/50 transition-colors"
  >
    <span class="material-symbols-outlined">close</span>
  </button>

  <!-- Logo/Brand -->
  <div class="p-6 border-b border-border-dark">
    <a routerLink="/dashboard" class="flex items-center gap-3" (click)="onNavClick()">
      <div class="size-10 text-primary shrink-0">
        <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
          <path d="M44 4H30.6666V17.3334H17.3334V30.6666H4V44H44V4Z" fill="currentColor"></path>
        </svg>
      </div>
      <h1 class="text-text-dark-primary text-xl font-bold tracking-tight">HabitFlow</h1>
    </a>
  </div>

  <!-- Navigation -->
  <nav class="flex-1 p-4">
    <div class="space-y-1">
      @for(link of navLinks(); track link.path) {
      <a
        [routerLink]="link.path"
        routerLinkActive="bg-primary/10 text-primary"
        [routerLinkActiveOptions]="{ exact: true }"
        class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-border-dark/50 transition-all duration-200 group"
        (click)="onNavClick()"
      >
        <span
          class="material-symbols-outlined text-xl group-hover:scale-110 transition-transform"
          >{{ link.icon }}</span
        >
        <p class="text-sm font-medium leading-normal">{{ link.name }}</p>
      </a>
      }
    </div>

    <!-- Add New Habit Button -->
    <button
      routerLink="/habit/new"
      (click)="onNavClick()"
      class="w-full mt-6 flex items-center justify-center gap-2 rounded-lg h-11 px-4 bg-primary text-background-dark text-sm font-semibold hover:opacity-90 transition-opacity shadow-sm"
    >
      <span class="material-symbols-outlined text-base">add</span>
      <span>Add New Habit</span>
    </button>
  </nav>

  <!-- User Profile -->
  <div class="p-4 border-t border-border-dark">
    <a
      routerLink="/settings"
      class="flex items-center gap-3 p-3 rounded-lg hover:bg-border-dark/50 transition-colors group"
      (click)="onNavClick()"
    >
      <div
        class="bg-center bg-no-repeat bg-cover rounded-full size-10 shrink-0 ring-2 ring-border-dark group-hover:ring-primary transition-all"
        style="background-image: url('https://picsum.photos/id/237/100/100')"
      ></div>
      <div class="flex-1 min-w-0">
        <h1 class="text-text-dark-primary text-sm font-medium leading-tight truncate">Alex Doe</h1>
        <p class="text-text-dark-secondary text-xs leading-tight truncate">alex.doe@email.com</p>
      </div>
      <span
        class="material-symbols-outlined text-text-dark-secondary opacity-0 group-hover:opacity-100 transition-opacity"
      >
        chevron_right
      </span>
    </a>
  </div>
</aside>
